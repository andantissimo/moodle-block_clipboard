define(["jquery","jqueryui","core/yui","core/ajax","core/templates","core/notification"],function(a,b,c,d,e,f){function g(a,b){return d.call([{methodname:a,args:b||{}}])[0]}function h(a,b){var d=M.util.add_lightbox(c,c.one(a.target)),e={courseid:n,section:+/^section-(\d+)$/.exec(a.target.id)[1],cmid:+b.draggable.attr("class").match(/starred-(\d+)/)[1]};g("block_favorites_duplicate",e).then(function(e){var f=c.Node.create(e.fullcontent);c.one(a.target).one("ul.section").appendChild(f),c.use("moodle-course-coursebase",function(){M.course.coursebase.invoke_function("setup_for_resource",f)}),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(f),b.draggable.css({left:0,top:0}),d.hide()})["catch"](function(){b.draggable.css({left:0,top:0}),d.hide()}),d.show()}function i(){a("li.section").droppable({accept:".type_activity",hoverClass:"highlight",drop:h})}function j(){o.find(".type_activity").draggable({revert:"invalid"})}function k(){g("block_favorites_get_tree").then(function(a){return e.render("block_favorites/content",a)}).then(function(a){o.html(a),j()})["catch"](f.exception)}function l(){var a=+this.id.match(/(\d+)$/)[1],b=!this.classList.contains("starred");g("block_favorites_star",{cmid:a,starred:b}).then(function(){this.classList[b?"add":"remove"]("starred"),k()}.bind(this))["catch"](f.exception)}function m(b){if(b.length&&b.attr("id")&&!b.find(".block_favorites-icon").length){var c=+b.attr("id").match(/^module-(\d+)$/)[1],d=a('<div class="block_favorites-icon"/>');d.attr("id","block_favorites-icon-"+c),o.find(".starred-"+c).length&&d.addClass("starred"),d.on("click",l),b.prepend(d)}}var n=+/course-(\d+)/.exec(document.body.className)[1],o=a(".block_favorites .content");return{setup:function(){i(),j(),a("ul.section li.activity").each(function(){m(a(this))});var b=!1;document.documentElement.addEventListener("mousedown",function(){b=!0},{capture:!0,passive:!0}),document.documentElement.addEventListener("mouseup",function(){b=!1},{capture:!0,passive:!0});var c=new MutationObserver(function(c){b||c.some(function(b){return b.target.classList&&b.target.classList.contains("editing_move")&&b.target.classList.contains("moodle-core-dragdrop-draghandle")?(m(a(b.target).closest("li.activity")),k(),!0):Array.prototype.some.call(b.addedNodes,function(a){return!(!a.classList||!a.classList.contains("section_add_menus")||0!==b.removedNodes.length)&&(k(),!0)})||Array.prototype.some.call(b.removedNodes,function(a){return a.classList&&a.classList.contains("updating")&&"activityname"===a.getAttribute("data-itemtype")?(k(),!0):!!/^module-\d+$/.test(a.id)&&(k(),!0)})})});setTimeout(function(){c.observe(document.querySelector(".course-content"),{childList:!0,subtree:!0})},1e3)}}});